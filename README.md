# Kraken-Optical-Simulator (KrakenOS)          
## Python - Exact ray tracing library 

Joel Herrera V., Carlos Guerrero P., Morgan Rhaí Najera Roa, Anais Sotelo B., Ilse Plauchu F.

• joel@astro.unam.mx

KrakenOS (Kraken - Optical Simulator) is a python library based in Numpy, Matplotlib, PyVTK and PyVista libraries, it provides a three-dimensional optical systems visualization and ray tracing. This tool has been programed on the object-oriented paradigm. KrakenOS focuses on performing sequential and non-sequential exact ray tracing, it permits to define all the parameters of the optical elements or even the mathematical function to describe their shape, it also allows adding optical properties to 3D solid elements in STL format and use glass catalogs. The library permit to control and modifying the position of the surfaces in a three-dimensional space, this allows generating off-axis systems. It also has several tools such as the calculation of wavefront aberrations in terms of Zernike polynomials, Seidel sums, Entrance and exit pupil calculation and paraxial optics.

## Prerequisites
The library has been tested with the following packages and versions.
• Python '3.7.4'          
• numpy '1.18.5'          
• pyvista '0.25.3'          
• pyvtk '0.5.18'  
• matplotlib '3.4.3'  
• vtk '8.2'          
• csv '1.0'          
• Place the directory “KrakenOS” in the same path where the code to be executed is located.          

## Surfaces and the optical system
The library has been simplified to the point of having only two classes of objects for the definition of a system, these are surf and system.
The surf object contains all the relevant information of every optical interface, in this way, every optical interface is an object of the surf class, all interfaces, from the object plane to the image plane, contain attributes of size, shape, material or orientation.

## User manual and examples
Very important, read the included user manual (KrakenOS_User_Manual.pdf) and the set of useful examples:

• Examp_Axicon.py          
• Examp_Axicon_And_Cylinder.py          
• Examp_Diffraction_Grating_Reflection.py          
• Examp_Diffraction_Grating_Transmission.py          
• Examp_Doublet_Lens_ParaxMatrix.py          
• Examp_Doublet_Lens.py          
• Examp_Doublet_Lens_3Dcolor.py          
• Examp_Doublet_Lens_CommandsSystem.py          
• Examp_Doublet_Lens_Cylinder.py          
• Examp_Doublet_Lens_NonSec.py          
• Examp_Doublet_Lens_Pupil.py          
• Examp_Doublet_Lens_Pupil_Seidel.py          
• Examp_Doublet_Lens_Tilt_Nulls.py          
• Examp_Doublet_Lens_Tilt.py          
• Examp_Doublet_Lens_Tilt_non_sec.py          
• Examp_Doublet_Lens_Zernike.py          
• Examp_ExtraShape_Micro_Lens_Array.py          
• Examp_ExtraShape_Radial_Sine.py          
• Examp_ExtraShape_XY_Cosines.py          
• Examp_Flat_Mirror_45Deg.py          
• Examp_MultiCore.py          
• Examp_ParaboleMirror_Shift.py          
• Examp_Perfect_lens.py          
• Examp_Ray.py          
• Examp_Solid_Object_STL.py          
• Examp_Solid_Object_STL_ARRAY.py          
• Examp_Sourse_Distribution_Function.py          
• Examp_Tel_2M.py          
• Examp_Tel_2M_Error_Map.py          
• Examp_Tel_2M_Pupila.py          
• Examp_Tel_2M_Spyder_Spot_Diagram.py          
• Examp_Tel_2M_Spyder_Spot_RMS.py          
• Examp_Tel_2M_Spyder_Spot_Tilt_M2.py          
• Examp_Tel_2M_Atmospheric_Refraction.py          
• Examp_Tel_2M_Wavefront_Fitting.py          

Enjoy it!!

| surf.Name = ""                       | Name of the element. Useful only for 2D diagram or ray identification.                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| surf.NamePos = (0,0)                 | Position of the note with the name “Name” in the 2D diagram. Default value: (0,0)                                                                                                                                                                                                                                                                                                                                                                                                          |
| surf.Note = "None"                   | Useful for adding user notes to a surface. Default value: None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| surf.Rc = 9999999999.0               | Paraxial radius of curvature in millimeters.Default value: 9999999999.0 or 0.0, both values will be interpreted as a plane.                                                                                                                                                                                                                                                                                                                                                                |
| surf.Cylinder\_Rxy\_Ratio = 1        | Ratio between the axial and sagittal radius of curvature. Useful for cylindrical and toroid lenses. Default value: 1                                                                                                                                                                                                                                                                                                                                                                       |
| surf.Axicon = 0                      | Axicon simulation, for values ​​other than zero an axicon is generated with the angle entered. Default value: 0                                                                                                                                                                                                                                                                                                                                                                            |
| surf.Thickness = 0.0                 | Distance between this surface and the next surface. Default value: 0.0, Units (mm)                                                                                                                                                                                                                                                                                                                                                                                                         |
| surf.Diameter = 1.0                  | Outside diameter of the surface. Default value: 1.0, Units (mm)                                                                                                                                                                                                                                                                                                                                                                                                                            |
| surf.InDiameter = 0.0                | Internal diameter of the surface. Useful for items such as a central aperture primary mirror. Default value: 0.0, Units (mm)                                                                                                                                                                                                                                                                                                                                                               |
| surf.k = 0.0                         | Conicity constant for classical conic surfaces, k = 0 for spherical, k = -1 for parabola, etc. Default value: 0.0                                                                                                                                                                                                                                                                                                                                                                          |
| surf.DespX = 0.0                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| surf.DespY = 0.0                     | Displacement of the surface in the X, Y and Z axis (in millimeters). Default values: 0.0                                                                                                                                                                                                                                                                                                                                                                                                   |
| surf.DespZ = 0.0                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| surf.TiltX = 0.0                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| surf.TiltY = 0.0                     | Rotation of the surface in the X, Y and Z axis (in degrees). Default values: 0.0                                                                                                                                                                                                                                                                                                                                                                                                           |
| surf.TiltZ = 0.0                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| surf.Order = 0                       | Define the order of the transformations. If the value is 0, the translations are performed first and then the rotations. If the value is 1 then the rotations are performed first and then the translations. Default value: 0                                                                                                                                                                                                                                                              |
| surf.AxisMove = 1                    | Defines what will happen to the optical axis after a coordinate transformation. If the value is 0, the transformation is only carried out to the surface in question. If the value is 1 then the transformation also affects the optical axis. Therefore, the other surfaces will follow the transformation. If the value is different, for example 2, then the optical axis will be affected twice. This is useful for flat mirrors (see Example -  Flat Mirror 45 Deg). Default value: 1 |
| surf.Diff\_Ord = 0.0                 | Diffraction order. Converts the element into a diffraction grating. The radius of curvature value is automatically omitted to make it a planar diffraction grating. This option can be used in transmission or refraction. Default value: 0.0                                                                                                                                                                                                                                              |
| surf.Grating\_D = 0.0                | Separation between the lines of the diffraction grating. Default value: 0.0. Units (µm)                                                                                                                                                                                                                                                                                                                                                                                                    |
| surf.Grating\_Angle = 0.0            | Angle of the grating lines in the plane of the surface, that is, around the optical axis. This is useful for simulating conic dispersion. Default value: 0.0, Units (Degrees)                                                                                                                                                                                                                                                                                                              |
| surf.ZNK = np.zeros (36)             | Numpy type array of 36 elements that correspond to the coefficients of the Zernike polynomials in the Noll nomenclature (Ref. 2)                                                                                                                                                                                                                                                                                                                                                           |
| surf.ShiftX = 0                      | Offsetting the surface profile feature on the X or Y axis. This is useful, for example, for off-axis surfaces such as parabolas. Default value: 0, Units (mm)                                                                                                                                                                                                                                                                                                                              |
| surf.ShiftY = 0                      |
| surf.Mask = 0                        | Type of mask to apply. The different values ​​are: (0) Do not apply mask, (1) Use mask as opening, (2) Use mask as obstruction. Default value: 0                                                                                                                                                                                                                                                                                                                                           |
| surf.Mask\_Shape = Object\_3D        | Form of the mask to apply, (Mask built with PyVista (pv) library).                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                      |
| surf.AspherData = np.zeros (Fix)     | Array of coefficients for aspherical surface. Array is a list of type Numpy.                                                                                                                                                                                                                                                                                                                                                                                                               |
| self.ExtraData = \[f, coef\]         | User-created surface with a sagite function dependent on (x, y, V), where V can contain an array of coefficients usable by the function                                                                                                                                                                                                                                                                                                                                                    |
|  |
| Surf.Error\_map = \[X, Y, Z, SPACE\] | It receives an error map generated with an array of type Numpy for the coordinates in X, Y and the height in Z with a space value between X, Y                                                                                                                                                                                                                                                                                                                                             |
| surf.Drawing = 1                     | Value equal to 1 for the element to be drawn in the 3D plot or value equal to 0 to omit the drawing of the element.                                                                                                                                                                                                                                                                                                                                                                        |
|  surf.Color = \[0,0,0\]              | Defines the color of the element in the format \[1,1,1\]. RGB color percentages (red, green, blue). Default value: (0,0,0) is black. Other colors are red (1,0,0), green (0,1,0), and blue (0,0,1).                                                                                                                                                                                                                                                                                        |
|  surf.Solid\_3d\_stl = "None"        | Path of the 3D solid object in STL format.                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
